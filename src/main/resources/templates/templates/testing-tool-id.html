<div class="row clearfix">
    <!-- Actuator Properties Card -->
    <div class="side-by-side">
        <div class="col-lg-6 side-by-side">
            <div class="card deployment-card">
                <div class="header"
                     ng-class="{'bg-red': testingChartCtrl.deploymentState=='NOT_READY', 'bg-green': testingChartCtrl.deploymentState=='READY', 'bg-teal': testingChartCtrl.deploymentState=='DEPLOYED', 'bg-cyan': testingChartCtrl.deploymentState=='RUNNING', 'bg-grey': testingChartCtrl.deploymentState=='UNKNOWN'}">
                    <i class="material-icons" style="position: absolute">bug_report</i>
                    <h2 style="margin-left: 35px;">
                        {{ctrl.test.name}}
                        <small>{{testingChartCtrl.deploymentState == 'NOT_READY' ? 'Start of Test impossible' :
                                (testingChartCtrl.deploymentState == 'READY' ? 'Ready for starting the Test' :
                                        (testingChartCtrl.deploymentState == 'RUNNING' ? 'Test Running' :
                                                (testingChartCtrl.deploymentState == 'UNKNOWN' ? 'Unknown state' : 'Loading...')))}}
                        </small>
                    </h2>
                    <ul class="header-dropdown m-r--5">
                        <li>
                            <a class="clickable" data-toggle="modal"
                               data-target="#editTestModal" data-backdrop="static" data-keyboard="false">
                                <i class="material-icons">edit</i>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="body">
                    <h4>Properties</h4>
                    <table class="table table-hover">
                        <tbody>
                        <tr id="{{ctrl.test.type}}">
                            <th>Sensor type(s):</th>
                            <td>{{ctrl.test.type.join(', ')}}</td>
                        </tr>
                        <tr id="{{ctrl.actionNames}}">
                            <th>Action types:</th>
                            <td>{{ctrl.actionNames}}</td>
                        </tr>
                        <tr>
                            <th>Testing Device:</th>
                            <td> TestingDevice
                            </td>
                        </tr>
                        <tr id="{{ctrl.ruleNames}}">
                            <th>Rules:</th>
                            <td> {{ctrl.ruleNames}}
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <br/>
                    <div>
                    <span ng-show="testingChartCtrl.deploymentState=='READY' || testingChartCtrl.deploymentState =='DEPLOYED'">
                        <div ng-switch on="testingChartCtrl.startTest">
                            <div ng-switch-when='STARTING_TEST'>
                                <button class="btn bg-cyan waves-effect" type="button" disabled>
                                    <span><div class="preloader pl-size-xs">
                                        <div class="spinner-layer pl-blue">
                                            <div class="circle-clipper left">
                                                <div class="circle"></div>
                                            </div>
                                            <div class="circle-clipper right">
                                                <div class="circle"></div>
                                            </div>
                                        </div>
                                    </div></span>
                                        <span style="position:relative; bottom:4px;">Starting...</span>
                                </button>
                            </div>
                            <div ng-switch-default>
                                <button class="btn bg-cyan waves-effect" ng-click="testingChartCtrl.startComponent()"
                                        ng-disabled="testingChartCtrl.startTest=='STARTING_TEST' || config.useNewData == true"
                                        type="button">
                                    <i class="material-icons">play_arrow</i>
                                    <span>Start Test</span>
                                </button>
                            </div>
                        </div>
                    </span>
                        <span ng-show="testingChartCtrl.deploymentState=='RUNNING'">
                        <button class="btn bg-orange waves-effect" ng-click="testingChartCtrl.stopComponent()">
                            <i class="material-icons">stop</i>
                            <span>Stop Test</span>
                        </button>
                    </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Report Card -->
        <div class="col-lg-6 side-by-side ">
            <div class="card stats-card side-by-side-scroll">
                <div class="header">
                    <h2>
                        Test Report overview
                        <small>Overview of the generated Test Reports of the already passed tests.</small>
                    </h2>
                </div>
                <div class="body">
                    <div class="switch" style="margin-left: 0px;">
                        Rerun Mode:
                        <label>
                            <input id="ReuseSwitch" type="checkbox" ng-model="config.useNewData"
                                   ng-click="ctrl.editConfig(config.useNewData)">
                            <span class="lever"></span>
                        </label>
                        <hr>
                    </div>

                    <div id="pdfTable">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>Date and Time</th>
                                <th>Test Report
                                </th>
                                <th ng-if="config.useNewData == true">Rerun Test</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="testReport in pdfTable | orderBy:'-date'">
                                <td>{{testReport.date * 1000 | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                                <td>
                                    <form ng-submit="testReportCtrl.openReport(testReport)"
                                          style="display: inline-block">
                                        <button type="submit" class="btn bg-cyan waves-effect">
                                            <span>Open Report</span>
                                        </button>
                                    </form>
                                </td>
                                <td class="align-center" ng-if="config.useNewData == true">
                                    <div ng-if="testReport.report.useNewData == false">

                                        <i class="material-icons">repeat</i>
                                    </div>
                                    <div ng-if="testReport.report.useNewData == true">
                                        <button class="btn bg-cyan waves-effect"
                                                ng-click="testingChartCtrl.rerunTest(testReport.report.id)"
                                                type="button">
                                            <i class="material-icons">repeat</i>
                                        </button>
                                    </div>
                                </td>
                                <td>
                                    <form ng-submit="ctrl.deleteTestReport(testReport.report.id)"
                                          style="margin-top: 3px;">
                                        <button type="submit" class="btn btn-danger m-t-0 waves-effect">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            <tr ng-show="pdfTable.length === 0">
                                <td>There is no Test Report for this Test yet.</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>


                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-12">
        <div class="card deployment-card">
            <div class="header">
                <i class="material-icons" style="position: absolute">call_split</i>
                <h2 style="margin-left: 35px;">
                    Rule Information of the tested IoT-Application
                </h2>
            </div>
            <div class="body">
                <table class="table table-hover" st-table="displayedCollection" st-safe-src="ruleListCtrl.items">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th class="align-center">Condition</th>
                        <th class="align-center">Actions</th>
                        <th class="align-center">Times Triggered</th>
                        <th class="align-center">Last</th>
                        <th class="align-center">Result</th>
                        <th class="align-center">Active</th>
                        <th class="align-center">Owner</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr id="{{rule.id}}" ng-repeat="rule in ruleList">
                        <td>
                            {{rule.name}}
                        </td>
                        <td class="align-center">
                            {{rule.triggerName}}
                        </td>
                        <td class="align-center">
                            {{rule.actionNames.join(", ")}}
                        </td>
                        <td class="align-center">
                            {{rule.executions}}
                        </td>
                        <td class="align-center">
                            {{rule.lastExecution ? rule.lastExecution : "Never"}}
                        </td>
                        <td class="align-center">
                            <div ng-switch="rule.lastExecutionResult">
                                <div ng-switch-when="SUCCESS">
                                    <span class="label label-success">Success</span>
                                </div>
                                <div ng-switch-when="FAILURE">
                                    <span class="label label-danger">Failure</span>
                                </div>
                                <div ng-switch-default>
                                    <span class="label label-default">None</span>
                                </div>
                            </div>
                        </td>
                        <td class="align-center">
                            <div class="switch">
                                <label>
                                    <input type="checkbox" ng-model="rule.enabled" ng-change="rule.onToggle()">
                                    <span class="lever"></span>
                                </label>
                            </div>
                        </td>
                        <td class="align-center">{{rule.ownerName ? rule.ownerName : "None"}}</td>
                        <td>
                            <form ng-submit="deleteRuleCtrl.deleteItem()" ng-show="rule.isDeletable"
                                  style="display: inline-block">
                                <button type="submit" class="btn btn-danger m-t-0 waves-effect"
                                        ng-click="deleteRuleCtrl.item.id = rule.id">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    <tr ng-show="ruleList.length === 0">
                        <td>No rules registered.</td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td class="text-center" st-pagination="" st-items-by-page="10" colspan="4"></td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="editTestModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Test: {{ctrl.test.name}}
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </h5>
                </div>
                <form id="editTestingForm" ng-submit="editTestCtrl.editItem()">
                    <fieldset id="testing-form">
                        <div id="bild" class="modal-body">
                            <div class="form-group" ng-class="{'has-error' : addTestCtrl.item.errors.global}">
			                    <span class="alert alert-danger" ng-show="addTestCtrl.item.errors.global">
			                      {{addTestCtrl.item.errors.global}}
			                    </span>
                            </div>
                            <div class="form-group">
                                <div class="form-line" ng-model="ctrl.sensorType" ng-value="{{ctrl.test.type}}">
                                    <h3> Sensor-Type(s): {{ctrl.test.type.join(', ')}} </h3>
                                    </select>
                                </div>
                            </div>

                            <div ng-repeat="realSensor in selectedRealSensor" ng-init="row=$index">
                                <h4>Configuration Real Sensor: {{realSensor.name}}</h4>
                                <table class="table parameter-table">
                                    <thead></thead>
                                    <tbody>
                                    <tr ng-repeat="parameter in realSensor.operator.parameters">
                                        <td>
                                            <label>{{parameter.name}}:</label><br/>
                                            <small ng-show="parameter.mandatory">(required)</small>
                                        </td>
                                        <td>
                                            <div ng-switch="parameter.type">
                                                <div ng-switch-when="Text">
                                                    <input class="form-control" type="text"
                                                           ng-required="parameter.mandatory"
                                                           ng-model="ctrl.parameterVal[realSensor.name][$index]"/>
                                                </div>
                                                <div ng-switch-when="Number">
                                                    <input class="form-control" type="number"
                                                           ng-required="parameter.mandatory"
                                                           ng-model="ctrl.parameterVal[realSensor.name][$index]"/>
                                                </div>
                                                <div class="switch" ng-switch-when="Switch">
                                                    <label>No
                                                        <input type="checkbox"
                                                               ng-model="ctrl.parameterVal[realSensor.name][$index]">
                                                        <span class="lever"></span>Yes</label>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="label bg-grey"
                                                  ng-show="parameter.unit">{{parameter.unit}}</span>
                                        </td>
                                    </tr>
                                    <tr ng-show="realSensor.operator.parameters.length === 0">
                                        <td colspan="2">No parameters required.</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div class="has-error" ng-show="ctrl.deployer.status.fieldErrors.parameters">
                                    <span class="help-block focused error">{{ctrl.deployer.status.fieldErrors.parameters}}</span>
                                </div>
                            </div>


                            <div ng-if="ctrl.sensorType.includes('TESTING_TemperatureSensor')">
                                <div class="form-line">
                                    <h3>Configuration Temperature Sensor Simulator</h3>
                                    <table class="table parameter-table">
                                        <thead></thead>
                                        <tbody>
                                        <tr>
                                            <td><label>Type of simulation:*</label></td>
                                            <td>
                                                <select class="form-control show-tick" id="select-event"
                                                        name="event"
                                                        ng-model="config.eventTemp">
                                                    {{config.event}}
                                                    <option value="">Select the event to be simulated</option>
                                                    <option ng-option class="ng-binding ng-scope" value="1">Temperature
                                                        rise
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="2"> Temperature
                                                        drop
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="3">Outliers
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="4">Missing
                                                        values
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="5">Wrong value
                                                        type
                                                    </option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td ng-if="config.eventTemp == '1' || config.eventTemp == '2'"><label>Combination
                                                with an anomaly:*</label></td>
                                            <td ng-if="config.eventTemp == '1' || config.eventTemp == '2'"><select
                                                    class="form-control show-tick" id="select-temp-Anomaly"
                                                    name="anomaly" ng-model="config.anomalyTemp">
                                                <option value="">Select the combination with an anomaly</option>
                                                <option ng-option class="ng-binding ng-scope" value="3">Outliers
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="4">Missing values
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="5">Wrong value type
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="6"
                                                        selected="selected">No combination
                                                </option>
                                            </select></td>
                                        </tr>
                                        <tr>
                                            <td ng-if="config.eventTemp == '1' || config.eventTemp == '2'"><label>For
                                                which
                                                room should the temperature rise/fall be simulated:* </label></td>
                                            <td ng-if="config.eventTemp == '1' || config.eventTemp == '2'">
                                                <select class="form-control show-tick"
                                                        name="room" ng-model="config.roomTemp">
                                                    <option value="">Select a room</option>
                                                    <option ng-option class="ng-binding ng-scope" value="a">Living room
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="b">Office
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="c">Bedroom
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="d">Bathroom
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="e">Kitchen
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="f">Basement
                                                    </option>
                                                </select>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>

                                </div>

                            </div>
                            <div ng-if="ctrl.sensorType.includes('TESTING_TemperatureSensorPl')">
                                <div class="form-line">
                                    <h3>Configuration Planned Temperature Sensor Simulator</h3>
                                    <table class="table parameter-table">
                                        <thead></thead>
                                        <tbody>
                                        <tr>
                                            <td><label>Type of simulation:*</label></td>
                                            <td>
                                                <select class="form-control show-tick"
                                                        name="event"
                                                        ng-model="config.eventTempPl">
                                                    <option value="">Select the event to be simulated</option>
                                                    <option ng-option class="ng-binding ng-scope" value="1">
                                                        Temperature rise
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="2">
                                                        Temperature drop
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="3">
                                                        Outliers
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="4">Missing
                                                        values
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="5">Wrong
                                                        value type
                                                    </option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td ng-if="config.eventTempPl == '1' ||config.eventTempPl == '2'">
                                                <label>Combination with an anomaly:*</label></td>
                                            <td ng-if="config.eventTempPl == '1' ||config.eventTempPl == '2'">
                                                <select class="form-control show-tick"
                                                        name="anomaly" ng-model="config.anomalyTempPl">
                                                    <option value="">Select the combination with an anomaly: *
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="3">
                                                        Outliers
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="4">Missing
                                                        values
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="5">Wrong
                                                        value type
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="6"
                                                            selected="selected">No combination
                                                    </option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td ng-if="config.eventTempPl == '1' ||config.eventTempPl == '2'">
                                                <label>For which room should the temperature rise/fall be
                                                    simulated:*</label></td>
                                            <td ng-if="config.eventTempPl == '1' ||config.eventTempPl == '2'">
                                                <select class="form-control show-tick"
                                                        name="room" ng-model="config.roomTempPl">
                                                    <option value="">Select a room</option>
                                                    <option ng-option class="ng-binding ng-scope" value="a">Living
                                                        room
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="b">Office
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="c">Bedroom
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="d">Bathroom
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="e">Kitchen
                                                    </option>
                                                    <option ng-option class="ng-binding ng-scope" value="f">Basement
                                                    </option>
                                                </select>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div ng-if="ctrl.sensorType.includes('TESTING_HumiditySensor')">
                                <h3>Configuration Humidity Sensor Simulator</h3>
                                <table class="table parameter-table">
                                    <thead></thead>
                                    <tbody>
                                    <tr>
                                        <td><label>Type of simulation:*</label></td>
                                        <td><select class="form-control show-tick" name="event"
                                                    ng-model="config.eventHum">
                                            <option value="">Select the event to be simulated</option>
                                            <option ng-option class="ng-binding ng-scope" value="1">
                                                Humidity rise
                                            </option>
                                            <option ng-option class="ng-binding ng-scope" value="2">
                                                Humidity decrease
                                            </option>
                                            <option ng-option class="ng-binding ng-scope" value="3">Outlier</option>
                                            <option ng-option class="ng-binding ng-scope" value="4">Missing values
                                            </option>
                                            <option ng-option class="ng-binding ng-scope" value="5">Wrong value type
                                            </option>
                                        </select></td>
                                    </tr>
                                    <tr>
                                        <td ng-if="config.eventHum == '1' ||config.eventHum == '2'"><label>Combination
                                            with an anomaly:* </label></td>
                                        <td ng-if="config.eventHum == '1' ||config.eventHum == '2'">
                                            <select class="form-control show-tick" id="select-hum-Anomaly"
                                                    name="anomaly" ng-model=" config.anomalyHum">
                                                <option value="">Select the combination with an anomaly</option>
                                                <option ng-option class="ng-binding ng-scope" value="3">Outliers
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="4">Missing
                                                    values
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="5">Wrong value
                                                    type
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="6">No
                                                    combination
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td ng-if="config.eventHum == '1' ||config.eventHum == '2'"><label>For which
                                            room should the humidity rise/fall be simulated:* </label></td>
                                        <td ng-if="config.eventHum == '1' ||config.eventHum == '2'">
                                            <select class="form-control show-tick"
                                                    name="room" ng-model="config.roomHum">
                                                <option value="">Select a room</option>
                                                <option ng-option class="ng-binding ng-scope" value="a">Living room
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="b">Office
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="c">Bedroom
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="d">Bathroom
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="e">Kitchen
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="f">Basement
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div ng-if="ctrl.sensorType.includes('TESTING_HumiditySensorPl')">
                                <h3>Configuration Planned Humidity Sensor Simulator</h3>
                                <table class="table parameter-table">
                                    <thead></thead>
                                    <tbody>
                                    <tr>
                                        <td><label>Type of simulation:*</label></td>
                                        <td>
                                            <select class="form-control show-tick" name="event"
                                                    ng-model="config.eventHumPl">
                                                <option value="">Select the event to be simulated</option>
                                                <option ng-option class="ng-binding ng-scope" value="1">
                                                    Humidity rise
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="2">
                                                    Humidity decrease
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="3">Outlier</option>
                                                <option ng-option class="ng-binding ng-scope" value="4">Missing values
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="5">Wrong value type
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td ng-if="config.eventHumPl == '1' ||config.eventHumPl == '2'"><label>Combination
                                            with an anomaly:*</label>
                                        </td>
                                        <td ng-if="config.eventHumPl == '1' ||config.eventHumPl == '2'">
                                            <select class="form-control show-tick"
                                                    name="anomaly" ng-model="config.anomalyHumPl">
                                                <option value="">Select the combination with an anomaly</option>
                                                <option ng-option class="ng-binding ng-scope" value="3">Outliers
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="4">Missing values
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="5">Wrong value type
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="6">No combination
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td ng-if="config.eventHumPl == '1' ||config.eventHumPl == '2'"><label> For
                                            which room
                                            should the humidity rise/fall be simulated:*</label>
                                        </td>
                                        <td ng-if="config.eventHumPl == '1' ||config.eventHumPl == '2'">
                                            <select class="form-control show-tick"
                                                    name="room" ng-model="config.roomHumPl">
                                                <option value="">Select a room</option>
                                                <option ng-option class="ng-binding ng-scope" value="a">Living room
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="b">Office
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="c">Bedroom
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="d">Bathroom
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="e">Kitchen
                                                </option>
                                                <option ng-option class="ng-binding ng-scope" value="f">Basement
                                                </option>
                                            </select>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="form-line"
                                 ng-if="ctrl.sensorType.includes('TESTING_HumiditySensorPl') || ctrl.sensorType.includes('TESTING_TemperatureSensorPl')">
                                <h3>Configuration Planned Simulation</h3>
                                <table class="table parameter-table">
                                    <thead></thead>
                                    <tbody>
                                    <tr>
                                        <td><label>Simulation time:*</label></td>
                                        <td>
                                            <div>
                                                <input class="form-control" type="text" id="simTime"
                                                       ng-model="config.simTime" placeholder="hours"/>
                                            </div>
                                        </td>
                                    <tr>
                                        <td><label>Amount events to be simulated:*</label></td>
                                        <td>
                                            <div>
                                                <input class="form-control" type="number" id="amountEvents"
                                                       ng-model="config.amountEvents" placeholder=""/>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label>Amount anomalies to be simulated:*</label></td>
                                        <td>
                                            <div><input class="form-control" type="number" id="amountAnomalies"
                                                        name="amountAnomalies"
                                                        ng-model="config.amountAnomalies"></div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="form-group">
                                <div class="form-line">
                                    <h3> Which rules should be observed?*</h3>
                                    <select class="form-control selectpicker" title="Rules"
                                            ng-model="selectedRules.rules"
                                            data-header="Rules to be observed"
                                            ng-options="rule as rule.name for rule in ctrl.ruleList"
                                            multiple>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">

                                <div class="radio">
                                    <input type="radio" class="with-gap" id="trigger_rules"
                                           ng-model="ctrl.executeRules"
                                           value="true"/>
                                    <label for="trigger_rules">The selected rules should be triggered. *</label>
                                </div>

                                <div class="radio">
                                    <input type="radio" class="with-gap" id="not_trigger_rules"
                                           ng-model="ctrl.executeRules"
                                           value="false"/>
                                    <label for="not_trigger_rules">The selected rules shouldn't be
                                        triggered. *</label>
                                </div>
                            </div>
                            <span class="help-block" style="font-style: italic">* Mandatory fields</span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary m-t-0 waves-effect" data-dismiss="modal">
                                Close
                            </button>
                            <button ng-click="ctrl.editTestConfiguration()"
                                    class="btn btn-primary m-t-0 waves-effect">
                                Update
                            </button>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
    <!--#END# Modal -->
</div>

<!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="testReport" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="text-align: center;"> TEST-REPORT: {{testReportAnzeige.name}}
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </h3>
                <div style="text-align: center;" ng-if="testReportAnzeige.useNewData == false">
                    <i class="material-icons" style="color:#8F8F8F" ;>repeat</i>
                    <h6 style="color:#8F8F8F" ;>
                        This was a Test Rerun
                    </h6>
                </div>
            </div>
            <form id="tableTest" ng-submit="addTestCtrl.addItem()">
                <fieldset id="testing-report">
                    <div class="modal-body">
                        <!-- "global" error for addItem -->
                        <div class="form-group" ng-class="{'has-error' : addTestCtrl.item.errors.global}">
			                    <span class="alert alert-danger" ng-show="addTestCtrl.item.errors.global">
			                      {{addTestCtrl.item.errors.global}}
			                    </span>
                        </div>
                        <!-- general infomation group -->
                        <div class="card deployment-card">
                            <div class="header">
                                <i class="material-icons" style="position: absolute">info</i>
                                <h2 style="margin-left: 35px;">
                                    General Information
                                </h2>
                            </div>
                            <div class="body">
                                <table id="generalInformation" class="table table-hover">
                                    <thead>
                                    <tr>
                                        <th>Start-Time</th>
                                        <th>End-Time</th>
                                        <th>State</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>{{testReportAnzeige.startTimeUnix * 1000 | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                                        <td>{{testReportAnzeige.endTimeUnix * 1000 | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                                        <td>
                                            <div ng-switch="testReportAnzeige.successful">
                                                <div ng-switch-when="Successful">
                                                    <span class="label label-success">{{testReportAnzeige.successful}}</span>
                                                </div>
                                                <div ng-switch-when="Not Successful">
                                                    <span class="label label-danger">{{testReportAnzeige.successful}}</span>
                                                </div>
                                                <div ng-switch-when="ERROR DURING TEST">
                                                    <span class="label label-danger">{{testReportAnzeige.successful}}</span>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>


                        <!-- sensor simulators information group -->
                        <div class="card deployment-card" ng-if="configTable.length >0">
                            <div class="header">
                                <i class="material-icons" style="position: absolute">settings_remote</i>
                                <h2 style="margin-left: 35px;">
                                    Involved Sensor-Simulators
                                </h2>
                            </div>
                            <div class="body">
                                <table id="simulatedSensorInfo" class="table table-hover" st-table="displayedCollection"
                                       st-safe-src="ruleListCtrl.items">
                                    <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Event</th>
                                        <th>Anomaly</th>

                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="testConfig in configTable">

                                        <td>{{testConfig.type}}
                                        </td>
                                        <td> {{testConfig.event}}
                                        </td>
                                        <td>
                                            {{testConfig.anomaly}}
                                        </td>
                                    </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- real sensor information group -->
                        <div class="card deployment-card" ng-if="realSensorList.length > 0">
                            <div class="header">
                                <i class="material-icons" style="position: absolute">settings_remote</i>
                                <h2 style="margin-left: 35px;">
                                    Involved Real-Sensors
                                </h2>
                            </div>
                            <div class="body">
                                <table id="informationRealSensors" class="table table-hover"
                                       st-table="displayedCollection">
                                    <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Sensor type</th>
                                        <th>Extraction operator</th>
                                        <th>Device</th>
                                        <th>Owner</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr id="{{realSensor.id}}"
                                        ng-repeat="realSensor in realSensorList">
                                        <td>{{realSensor.name}}
                                        </td>
                                        <td>{{realSensor.componentType}}</td>
                                        <td>{{realSensor.operator.name}}</td>
                                        <td>{{realSensor.device.name}}</td>
                                        <td>
                                            {{realSensor.ownerName ? realSensor.ownerName : "None"}}
                                        </td>

                                    </tr>
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td class="text-center" st-pagination="" st-items-by-page="10" colspan="4"></td>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        <div id="chart" class="card deployment-card"
                             ng-if="realSensorList.length > 0 || simulatedSensorList.length > 0">
                            <div class="header">
                                <i class="material-icons" style="position: absolute">show_chart</i>
                                <h2 style="margin-left: 35px;">
                                    Generated Sensor values during the test
                                </h2>
                            </div>
                            <div class="body">
                                <!-- Display tables for all sensor values during the test -->
                                <div id="accordion">
                                    <div ng-repeat="simVals in simulationValues">
                                        <div class="card deployment-card" style="margin-bottom: 10px;">
                                            <div class="header" id="heading-{{$index}}"
                                                 style="padding-top: 0px;padding-bottom: 0px;padding-left: 0px;">
                                                <button class="btn btn-link collapsed" data-toggle="collapse"
                                                        data-target="#collapse-{{$index}}" aria-expanded="false"
                                                        aria-controls="collapse-{{$index}}">
                                                    <h5 style="margin-top: 10px;">
                                                        {{simVals.name}}
                                                    </h5>
                                                </button>
                                            </div>
                                            <div id="collapse-{{$index}}" class="collapse"
                                                 aria-labelledby="heading-{{$index}}"
                                                 data-parent="#accordion">
                                                <div class="body" style="max-height: 350px;overflow: scroll;overflow-x: hidden;">
                                                    <table class="table table-hover" >
                                                        <thead>
                                                        <tr>
                                                            <th>Time</th>
                                                            <th>Data</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr ng-repeat="simData in simVals.data">
                                                            <td>
                                                                {{simData[0]}}
                                                            </td>
                                                            <td style="padding-bottom: 0px;">
                                                                <ul class="list-group" style="margin-bottom: 10px;">
                                                                    <li class="list-group-item">
                                                                        <json-formatter json="simData[1]"
                                                                                        open="0"></json-formatter>
                                                                    </li>
                                                                </ul>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- rule information group -->
                        <div class="card deployment-card">
                            <div class="header">
                                <i class="material-icons" style="position: absolute">call_split</i>
                                <h2 style="margin-left: 35px;">
                                    Rule Information of the tested IoT-Application
                                </h2>
                            </div>
                            <div class="body">
                                <table id="triggerRulesInfo" class="table table-hover" st-table="displayedCollection"
                                       st-safe-src="ruleListCtrl.items">
                                    <thead>
                                    <tr>
                                        <th>The selected rule(s) should be triggered</th>
                                        <th>Rules, which should be triggered</th>
                                        <th>Rules, which were triggered</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <td>
                                        <div ng-switch="testReportAnzeige.triggerRules">
                                            <div ng-switch-when="true">Yes</div>
                                            <div ng-switch-when="false">No</div>
                                        </div>
                                    </td>
                                    <td>
                                        {{testReportAnzeige.ruleNames.join(', ')}}
                                    </td>
                                    <td>
                                        <div ng-if="testReportAnzeige.rulesExecuted.length >0">
                                            {{testReportAnzeige.rulesExecuted.join(', ')}}
                                        </div>

                                        <div ng-if="testReportAnzeige.rulesExecuted.length == 0 || testReportAnzeige.rulesExecuted == undefined">
                                            -
                                        </div>
                                    </td>
                                    </tbody>
                                </table>


                                <table id="rulesTriggered" class="table table-hover" st-table="displayedCollection"
                                       st-safe-src="ruleListCtrl.items">
                                    <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Condition</th>
                                        <th>Times Triggered during Test</th>
                                        <th>Trigger Values</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="rule in testReportAnzeige.ruleInformationBefore">
                                        <td>
                                            {{rule.name}}
                                        </td>
                                        <td>
                                            <div>
                                                <a class="clickable" data-toggle="collapse"
                                                   data-target="#query-{{rule.id}}">
                                                    {{rule.trigger.name}}
                                                </a>
                                                <div id="query-{{rule.id}}" class="collapse">
                                                    <code>{{rule.trigger.query}}</code>
                                                </div>
                                            </div>
                                        </td>
                                        <td ng-repeat="amountTriggerAfter in rulesTriggered | filter:{name:rule.name}:true">
                                            {{amountTriggerAfter.executions}}
                                        </td>
                                        <td>
                                            <a class="clickable" data-toggle="collapse"
                                               data-target="#triggerValues-{{rule.id}}">
                                                Show Trigger values
                                            </a>
                                            <div id="triggerValues-{{rule.id}}" class="collapse">
                                                <div ng-repeat=" values in triggerValues | filter:{ruleName:rule.name}:true">
                                                    <ul class="list-group" style="margin-bottom: 10px;">
                                                        <div ng-repeat="value in values.triggerValues">
                                                            <li class="list-group-item">
                                                                <json-formatter json="value" open="0"></json-formatter>
                                                                <!--<json-formatter
                                                                        json="$parent.testReportCtrl.convertAngularJsToJs(value)"
                                                                        open="0"></json-formatter>-->
                                                            </li>
                                                        </div>
                                                    </ul>
                                                    <!--<code>{{values.triggerValues.join(", ")}}</code>-->
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- next steps-->

                        <div class="card deployment-card"
                             ng-if="testReportAnzeige.successful =='Not Successful' ||  testReportAnzeige.successful =='ERROR DURING TEST'">
                            <div class="header">
                                <i class="material-icons" style="position: absolute">arrow_forward</i>
                                <h2 style="margin-left: 35px;">
                                    Next Steps
                                </h2>
                            </div>
                            <div class="body">
                                <div ng-switch="testReportAnzeige.successful">
                                    <div ng-switch-when="Not Successful">
                                        <p>Rules were triggered that shouldn't have been triggered: </p>
                                        <p> &ensp; &ensp; 1. Check which values led to the triggering of this rule. </p>
                                        <p> &ensp; &ensp; 2. Check if it was just a sensor anomaly or if the condition
                                            of the rule was
                                            set too sensitively.
                                        <p> &ensp; &ensp; 3. Adjust the condition of the rule accordingly.
                                        <p> &ensp; &ensp; &ensp; &ensp; &#8226; For example: increase the time window /
                                            window
                                            length, set the average higher, ...
                                        <p> &ensp; &ensp; 4. Repeat the test under the same conditions and check the
                                            result again.
                                        <p> &ensp; &ensp; 5. Repeat this procedure until the test is completed
                                            successfully.
                                        <hr>
                                        <p>Rules which should have been triggered weren't triggered: </p>
                                        <p> &ensp; &ensp; 1. Check the values of the test and the condition of the rule,
                                            why the rule was not triggered. </p>
                                        <p> &ensp; &ensp; 2. Set the condition of the rule to be more sensitive to the
                                            values.
                                        <p> &ensp; &ensp; &ensp; &ensp; &#8226; For example: decrease the time window /
                                            window
                                            length, lower the average, ...
                                        <p> &ensp; &ensp; 4. Repeat the test under the same conditions and check the
                                            result again.
                                        <p> &ensp; &ensp; 5. Repeat this procedure until the test is completed
                                            successfully.

                                    </div>
                                    <div ng-switch-when="ERROR DURING TEST">
                                        Possible actions to solve the problem that caused the error:
                                        <p> &ensp; &ensp; &#8226; Check your WiFi and VPN connection. </p>
                                        <p> &ensp; &ensp; &#8226; Check your MQTT broker settings and may change the IP
                                            adress of your broker.</p>
                                        <p> &ensp; &ensp; &#8226; Reinstall / redeploy the default testing components
                                            via the settings.</p>

                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary m-t-0 waves-effect"
                                data-dismiss="modal">
                            Close
                        </button>
                        <button id="getPDF"
                                class="btn bg-blue m-t-0 waves-effect"
                                ng-click="testReportCtrl.getPDF(testReportAnzeige)">
                            Export as PDF
                        </button>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>
<!-- #END# Modal -->

<!-- Sensor visualization charts -->
<div ng-repeat="sensor in ctrl.sensorList">
    <customizable-chart-card component-data="sensor"
                             instance-id="{{$index}}"
                             historical-chart-api="historicalChartApi"
                             deployment-state="testingChartCtrl.deploymentState"
    ></customizable-chart-card>
</div>


